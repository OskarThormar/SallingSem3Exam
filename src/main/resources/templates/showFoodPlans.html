<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>These are your food plans!</h1>
<div id="madplan-container"></div>
<button id="createFoodPlanBtn">Create Food Plan</button>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Hent alle madplaner fra API'et
        fetch('/api/plan/foodPlan')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('madplan-container');

                // Iterer gennem hver madplan og opret et element for hver
                data.forEach(madplan => {
                    const madplanElement = document.createElement('div');
                    madplanElement.classList.add('madplan');
                    madplanElement.setAttribute('data-id', madplan.id); // Tilføj data-id

                    // Opret et span-element for madplanens navn
                    const madplanName = document.createElement('span');
                    madplanName.classList.add('name');
                    madplanName.textContent = madplan.name;
                    madplanElement.appendChild(madplanName);

                    // Opret Delete knap
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', (e) => {
                        e.stopPropagation(); // Forhindrer klik på madplanen
                        if (confirm(`Are you sure you want to delete the food plan "${madplan.name}"?`)) {
                            deleteMadPlan(madplan.id);
                        }
                    });

                    // Opret Edit knap
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Edit';
                    editButton.addEventListener('click', (e) => {
                        e.stopPropagation(); // Forhindrer klik på madplanen
                        editMadPlan(madplan);
                    });

                    // Tilføj knapperne til madplan-elementet
                    madplanElement.appendChild(deleteButton);
                    madplanElement.appendChild(editButton);

                    // Tilføj madplan-elementet til containeren
                    container.appendChild(madplanElement);
                });
            })
            .catch(error => {
                console.error('Error fetching madplan data:', error);
            });

        document.getElementById('createFoodPlanBtn').addEventListener('click', function () {
            window.location.href = 'createFoodplan';
        });

        // Funktion til at slette en madplan
        function deleteMadPlan(id) {
            fetch(`/api/plan/foodPlan/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        alert('Food plan deleted successfully!');
                        location.reload(); // Opdater siden for at fjerne den slettede madplan
                    } else {
                        alert('Failed to delete the food plan.');
                    }
                })
                .catch(error => {
                    console.error('Error deleting the food plan:', error);
                });
        }

        // Funktion til at redigere en madplan
        function editMadPlan(madplan) {
            const newName = prompt('Enter the new name for the food plan:', madplan.name);
            if (newName && newName !== madplan.name) {
                const updatedMadPlan = { ...madplan, name: newName };

                fetch(`/api/plan/foodPlan/${madplan.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedMadPlan)
                })
                    .then(response => {
                        if (response.ok) {
                            // Find madplanen i DOM'en og opdater dens navn
                            const madplanElement = document.querySelector(`[data-id="${madplan.id}"]`);
                            if (madplanElement) {
                                madplanElement.querySelector('.name').textContent = newName; // Opdater navnet i DOM
                            }
                            alert('Food plan updated successfully!');
                        } else {
                            alert('Failed to update the food plan.');
                        }
                    })
                    .catch(error => {
                        console.error('Error updating the food plan:', error);
                    });
            }
        }
    });
</script>
</body>
</html>
